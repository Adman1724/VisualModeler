

@Styles.Render("~/Content/Editor.css")
@Styles.Render("~/Content/bootstrap.css")
@Styles.Render("~/Content/collapsMenu.css")
@Styles.Render("~/Content/collapsMenuRight.css")

@Styles.Render("https://fonts.googleapis.com/icon?family=Material+Icons")



@{
    Layout = null;
}
<script src="../../Scripts/fabric.js-1.7.22/dist/fabric.min.js"></script>
<script src="../../Scripts/js/classes/class.js"></script>
<script src="../../Scripts/js/function/CanvasManupulation.js"></script>
<script src="../../Scripts/js/classes/classObject.js"></script>
<script src="../../Scripts/js/Use-case/Actor.js"></script>
<script src="../../Scripts/js/Use-case/UseCase.js"></script>
<script src="../../Scripts/js/Use-case/System.js"></script>
<script src="../../Scripts/js/squence/ObjectSeq.js"></script>
<script src="../../Scripts/js/squence/Activation.js"></script>
<script src="../../Scripts/js/squence/Lifeline.js"></script>
<script src="../../Scripts/js/activity/ConditionCheck.js"></script>
<script src="../../Scripts/js/activity/StartOfProcess.js"></script>
<script src="../../Scripts/js/activity/Terminator.js"></script>
<script src="../../Scripts/js/activity/ActivityObject.js"></script>
<script src="../../Scripts/js/function/Creator.js"></script>
<script src="../../Scripts/js/function/RightMenuDynamic.js"></script>
<script src="../../Scripts/js/classes/ArrowClass.js"></script>

<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
<script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
<!-- Bootstrap Js CDN -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<script type="text/javascript">
    $(document).ready(function () {
        $('#sidebarCollapse').on('click', function () {
            $('#sidebar').toggleClass('active');
        });
    });
</script>
<script type="text/javascript">
    $(document).ready(function () {
        $('#sidebarCollapseR').on('click', function () {
            $('#sidebarR').toggleClass('active');
        });
    });
</script>




<script>
    function reloadPage() {

            return "Do you really want to leave our brilliant application?";

    }
    var first;
    var canvas;
    var canvasItems;
    var id = 1;
    var mouseX;
    var mouseY;

    function SetValues() {
        mouseX = window.event.clientX;
        mouseY=window.event.clientY;


    }


    function addClass() {


        SetValues();
        var width = 200;
        createClass(canvas, canvasItems, id, mouseX-250-width/2, mouseY-56,width);
        id++;


        canvas.clear();
        canvasAdd(canvasItems, canvas);
    }
    function addArrowClass(tH, tB, tF) {
        SetValues();
        var width = 300;

        createArrowClass(canvas, canvasItems, id, tH, tB, tF, mouseX - 250 - width / 2, mouseY - 56, width);
        id++;
        canvas.clear();
        canvasAdd(canvasItems, canvas);
    }
    function addUsecase() {
        SetValues();
        var width = 200;
        var height = 50;
        createUsecase(canvas, canvasItems, id, mouseX - 250 - width / 2, mouseY - 56, width,height);
        id++;
        canvas.clear();
        canvasAdd(canvasItems, canvas);
    }
    function addSystem() {
        SetValues();
        var width = 200;
        var height = 200;
        createSystem(canvas, canvasItems, id, mouseX - 250 - width / 2, mouseY - 56, width, height);
        id++;
        canvas.clear();
        canvasAdd(canvasItems, canvas);
    }
    function addActor() {
        SetValues();
        var width = 100;

        createActor(canvas, canvasItems, id, mouseX - 250 - width / 2, mouseY - 56, width);
        id++;
        canvas.clear();
        canvasAdd(canvasItems, canvas);
    }
    function addObjectSeq() {
        SetValues();
        var width = 150;
        var height = 50;
        createObjectSeq(canvas, canvasItems, id, mouseX - 250 - width / 2, mouseY - 56, width, height);
        id++;
        canvas.clear();
        canvasAdd(canvasItems, canvas);
    }
    function addActivation() {
        SetValues();
        var width = 30;
        var height = 250;
        createActivation(canvas, canvasItems, id, mouseX - 250 - width / 2, mouseY - 56, width, height);
        id++;
        canvas.clear();
        canvasAdd(canvasItems, canvas);
    }

    function addLifeline() {
        SetValues();
        var width = 3;
        var height = 250;
        createLifeline(canvas, canvasItems, id, mouseX - 250 - width / 2, mouseY - 56, height,width);
        id++;
        canvas.clear();
        canvasAdd(canvasItems, canvas);
    }
    function addConditionCheck() {
        SetValues();
        var width = 50;
        var height = 50;
        createConditionCheck(canvas, canvasItems, id, mouseX - 250 - width / 2, mouseY - 56, height);
        id++;
        canvas.clear();
        canvasAdd(canvasItems, canvas);
    }
    function addStartOfProcess() {
        SetValues();
        var width = 35;
        var height = 35;
        createStartOfProcess(canvas, canvasItems, id, mouseX - 250 - width / 2, mouseY - 56, height);
        id++;
        canvas.clear();
        canvasAdd(canvasItems, canvas);
    }
    function addTerminator() {
        SetValues();
        var width = 35;
        var height = 35;
        createTerminator(canvas, canvasItems, id, mouseX - 250 - width / 2, mouseY - 56, height);
        id++;
        canvas.clear();
        canvasAdd(canvasItems, canvas);
    }
    function addActivityObject() {
        SetValues();
        var width = 150;
        var height = 50;
        createActivityObject(canvas, canvasItems, id, mouseX - 250 - width / 2, mouseY - 56,width, height);
        id++;
        canvas.clear();
        canvasAdd(canvasItems, canvas);
    }
    function remove() {
        removeItem(canvasItems, canvas);
    }
    var zoom = 3;
    function zoomIn() {
        if (zoom < 7) zoom++;
        var zoombox = [0.25, 0.5, 0.75,1,1.25,1.5,1.75,2]
      
        canvas.setZoom(zoombox[zoom]);
    }
    function zoomOut() {
        if (zoom > 0) zoom--;
        var zoombox = [0.25, 0.5, 0.75, 1, 1.25, 1.5, 1.75, 2]

        canvas.setZoom(zoombox[zoom]);
    }

    $(document).ready(function () {

        document.getElementById("can").style.height = screen.height - 170;
        var canvasOptions = {
        };
        var canvasId = 'c';
        canvas = new fabric.Canvas(canvasId, canvasOptions);
        canvas.backgroundColor = "#F2F2F2";
        canvasItems = [];
        canvasAdd(canvasItems, canvas);
        canvas.on('object:modified', onObjectScaled);

        function onObjectScaled(e) {
            console.log("onobjectscaled");
            console.log(e.target);
            var scaledObject = e.target;
            //updateData(canvasItems, canvas);
            for (var i = 0; i < canvasItems.length; i++) {
                if (canvasItems[i].group == scaledObject && canvasItems[i].type !== "arrowClass") {

                   canvasItems[i].changeWidth(scaledObject.getWidth());
                   $('#' + canvasItems[i].id + "width").val(canvasItems[i].width);
                   canvasItems[i].changeHeight(scaledObject.getHeight() );
                   $('#' + canvasItems[i].id + "height").val(canvasItems[i].height);

              }
           }
            canvas.clear();
            canvasAdd(canvasItems, canvas);

        }
        canvas.on('object:selected', onObjectSelected);
       
        function onObjectSelected(e) {
            var previous = 0;
            for (var i = 0; i < canvasItems.length; i++) {
                if (canvasItems[i].group == selectedObject) {

                     previous = canvasItems[i].id;

                }

            }
            selectedObject = e.target;
            for (var i = 0; i<canvasItems.length; i++) {
                if (canvasItems[i].group == selectedObject) {

                    openSelected(canvasItems[i].id, previous);

                }
            }

        }
        var ar1 = document.querySelector('#ar1');
        ar1.addEventListener('dragend', function () {
            addArrowClass('AR', 'LL', 'NN')
        });
        var ar2 = document.querySelector('#ar2');
        ar2.addEventListener('dragend', function () {
            addArrowClass('AG', 'DD', 'NN')
        });
        var ar3 = document.querySelector('#ar3');
        ar3.addEventListener('dragend', function () {
            addArrowClass('AG', 'LL', 'NN')
        });
        var ar4 = document.querySelector('#ar4');
        ar4.addEventListener('dragend', function () {
            addArrowClass('AR', 'DD', 'NN')
        });
        var ar5 = document.querySelector('#ar5');
        ar5.addEventListener('dragend', function () {
            addArrowClass('AR', 'LL', 'NN')
        });
        var ar6 = document.querySelector('#ar6');
        ar6.addEventListener('dragend', function () {
            addArrowClass('AB', 'DD', 'NN')
        });
        var ar7 = document.querySelector('#ar7');
        ar7.addEventListener('dragend', function () {
            addArrowClass('AB', 'LL', 'NN')
        });
        var ar8 = document.querySelector('#ar8');
        ar8.addEventListener('dragend', function () {
            addArrowClass('AW', 'DD', 'NN')
        });
        var ar9 = document.querySelector('#ar9');
        ar9.addEventListener('dragend', function () {
            addArrowClass('AW', 'LL', 'NN')
        });
        var ar10 = document.querySelector('#ar10');
        ar10.addEventListener('dragend', function () {
            addArrowClass('AC', 'DD', 'NN')
        });
        var ar11 = document.querySelector('#ar11');
        ar11.addEventListener('dragend', function () {
            addArrowClass('AC', 'LL', 'NN')
        });
        var class1 = document.querySelector('#class1');
        class1.addEventListener('dragend', function () {
            addClass();
        });
        var uscs = document.querySelector('#uscs');
        uscs.addEventListener('dragend', function () {
            addUsecase();
        });
        var act = document.querySelector('#act');
        act.addEventListener('dragend', function () {
            addActor();
        });
        var sys = document.querySelector('#sys');
        sys.addEventListener('dragend', function () {
            addSystem();
        });
        var objS = document.querySelector('#objS');
        objS.addEventListener('dragend', function () {
            addObjectSeq();
        });
        var activ = document.querySelector('#activ');
        activ.addEventListener('dragend', function () {
            addActivation();
        });
        var life = document.querySelector('#life');
        life.addEventListener('dragend', function () {
            addLifeline();
        });
        var actO = document.querySelector('#actO');
        actO.addEventListener('dragend', function () {
            addActivityObject();
        });
        var coCh = document.querySelector('#coCh');
        coCh.addEventListener('dragend', function () {
            addConditionCheck();
        });
        var stPr = document.querySelector('#stPr');
        stPr.addEventListener('dragend', function () {
            addStartOfProcess();
        });
        var ter = document.querySelector('#ter');
        ter.addEventListener('dragend', function () {
            addTerminator();
        });

       


    });

    function save() {
        var data = JSON.stringify(canvas);
        // clear canvas
        canvas.clear();
        canvasItems = [];

        setTimeout(function () {
            canvas.loadFromJSON(data, function () {

                // making sure to render canvas at the end

                canvas.renderAll();
            });

        }, 7000)

        // and load everything from the same json
       
         $.ajax({
             url: '@Url.Action("Save","Home")',
             data: { data: data },
                type: "post",
                success: function (data) {
                    $("#").append(data);
                }
            });
        }

</script>



@{
    ViewBag.Title = "DrawMajo";
}
<div class="menu" >
    <div class="title-left">
        <h2>@ViewBag.Title</h2>
        <button type="button" id="sidebarCollapse" class="btn btn-info1 navbar-btn">
            <i class="glyphicon glyphicon-align-left"></i>

        </button>
    </div>
    <div class="title-center">
        <div class="item-container">
            <div class="item-box">
                <i class="material-icons">near_me</i>
                <p class="item-box">Move</p>
            </div>
            <!-- <div class="item-box">
           <i class="material-icons">fullscreen</i>
            <p class="item-box">Select</p>
        </div>-->
            <div class="item-box-red" onclick="remove()">
                <i class="material-icons">close</i>
                <p class="item-box-red">Remove</p>
            </div>
            <div class="item-box-green"  onclick="save()">
                <i class="material-icons">save</i>
                <p class="item-box-green">Save</p>
            </div>
            <div class="item-box" onclick="zoomIn()">
                <i class="material-icons">zoom_in</i>
                <p class="item-box">In</p>
            </div>
            <div class="item-box-red" onclick="zoomOut()">
                <i class="material-icons">zoom_out</i>
                <p class="item-box-red">Out</p>
            </div>

        </div>
        <!--  <div class="search-box">
            <i class="material-icons">search</i>
    <input type="text" placeholder="Search..">
        <input id="zoom" type="range" min="1" max="8" value="4" onchange="zoom()">

    </div>-->

    </div>
    <div class="title-right">

      

     <div class="centringButton" style="padding-top: 3px;">   <button type="button" id="sidebarCollapseR" class="centringButton btn btn-info1 navbar-btn "><i class="material-icons md-48">reorder</i></button></div>


        <div class="centringButton"><button class="dropbtn"> <i class="material-icons md-48">account_box</i></button></div>
            </div>
    </div>
</div>

<div class="wrapper" onmousemove=SetValues()>
    <!-- Sidebar Holder -->
    <nav id="sidebar">
        <div class="rightMenuScroll">

            <ul class="list-unstyled components">
                <li class="active">
                    <a href="#Class" data-toggle="collapse" id="kokot" aria-expanded="false">Class Diagrams</a>
                    <ul class="collapse list-unstyled " id="Class">
                        <div class="list-inline">
                            <li  id="class1"draggable="true"><a href="#" onmouseup="addClass()"  > <img src="~/Content/MenuItems/class.png" alt="Image" style="width:80px;"  /></a></lidraggable="true">
                            <li id="ar1"draggable="true"><a href="#" onclick="addArrowClass('AR','LL','NN')"> <img src="~/Content/MenuItems/arrowBlack_fullLine.png" alt="Image" style="width:80px;" /></a></li>

                        </div>
                        <div class="list-inline">
                            <li id="ar2"draggable="true"><a href="#" onclick="addArrowClass('AG','DD','NN')"> <img src="~/Content/MenuItems/agregation_dashedLine.png" alt="Image" style="width:80px;" /></a></li>
                            <li id="ar3"draggable="true"> <a href="#" onclick="addArrowClass('AG','LL','NN')"> <img src="~/Content/MenuItems/agregation_Line.png" alt="Image" style="width:80px;" /></a></li>

                        </div>
                        <div class="list-inline">
                            <li id="ar4"draggable="true"><a href="#" onclick="addArrowClass('AR','DD','NN')"> <img src="~/Content/MenuItems/arrowBlack_dashedLine.png" alt="Image" style="width:80px;" /></a></li>
                            <li id="ar5"draggable="true"><a href="#" onclick="addArrowClass('AR','LL','NN')"> <img src="~/Content/MenuItems/arrowBlack_fullLine.png" alt="Image" style="width:80px;" /></a></liid="ar1"draggable="true">

                        </div>
                        <div class="list-inline">
                            <li id="ar6"draggable="true"><a href="#" onclick="addArrowClass('AB','DD','NN')"> <img src="~/Content/MenuItems/arrowFullBlack_dashedLine.png" alt="Image" style="width:80px;" /></a></li>
                            <li id="ar7"draggable="true"><a href="#" onclick="addArrowClass('AB','LL','NN')"> <img src="~/Content/MenuItems/arrowFullBlack_line.png" alt="Image" style="width:80px;" /></a></li>

                        </div>
                        <div class="list-inline">
                            <li id="ar8"draggable="true"><a href="#" onclick="addArrowClass('AW','DD','NN')"> <img src="~/Content/MenuItems/arrowFullWhite_dashedLine.png" alt="Image" style="width:80px;" /></a></li>
                            <li id="ar9"draggable="true"><a href="#" onclick="addArrowClass('AW','LL','NN')"> <img src="~/Content/MenuItems/arrowFullWhite_line.png" alt="Image" style="width:80px;" /></a></li>

                        </div>
                        <div class="list-inline">
                            <li id="ar10"draggable="true"><a href="#" onclick="addArrowClass('AC','DD','NN')"> <img src="~/Content/MenuItems/composition_dashedLine.png" alt="Image" style="width:80px;" /></a></li>
                            <li id="ar11"draggable="true"><a href="#" onclick="addArrowClass('AC','LL','NN')"> <img src="~/Content/MenuItems/composition_line.png" alt="Image" style="width:80px;" /></a></li>

                        </div>
                    </ul>
                </li>
                <li>

                    <a href="#pag1" data-toggle="collapse" aria-expanded="false">Use-Case</a>
                    <ul class="collapse list-unstyled" id="pag1">
                        <div class="list-inline">
                            <li id="uscs"draggable="true"><a href="#" onclick="addUsecase()"> <img src="~/Content/MenuItems/usecase.png" alt="Image" style="width:100px;" /></a></li>
                            <li id="act"draggable="true"><a href="#" onclick="addActor()"> <img src="~/Content/MenuItems/actor.png" alt="Image" style="width:50px;" /></a></li>
                        </div>
                        <div class="list-inline">
                            <li id="sys"draggable="true"><a href="#" onclick="addSystem()"> <img src="~/Content/MenuItems/system.png" alt="Image" style="width:100px;" /></a></li>

                        </div>
                    </ul>
                </li>
                <li>

                    <a href="#seq" data-toggle="collapse" aria-expanded="false">Sequence diagrams</a>
                    <ul class="collapse list-unstyled" id="seq">
                        <div class="list-inline">
                            <li id="objS"draggable="true"><a href="#" onclick="addObjectSeq()"> <img src="~/Content/MenuItems/objectseq.png" alt="Image" style="width:100px;" /></a></li>
                            <li id="activ"draggable="true"><a href="#" onclick="addActivation()"> <img src="~/Content/MenuItems/activation.png" alt="Image" style=" height: 50px;" /></a></li>

                        </div>
                        <div class="list-inline">
                            <li id="life"draggable="true"><a href="#" onclick="addLifeline()"> <img src="~/Content/MenuItems/lifeline.png" alt="Image" style=" height: 50px;" /></a></li>

                        </div>
                    </ul>
                </li>
                <li>

                    <a href="#activityDiagrams" data-toggle="collapse" aria-expanded="false">Activity diagrams</a>
                    <ul class="collapse list-unstyled" id="activityDiagrams">
                        <div class="list-inline">
                            <li id="actO"draggable="true"><a href="#" onclick="addActivityObject()"> <img src="~/Content/MenuItems/activita.png" alt="Image" style="width:100px;" /></a></li>
                            <li id="coCh"draggable="true"><a href="#" onclick="addConditionCheck()"> <img src="~/Content/MenuItems/condition_check.png" alt="Image" style=" height: 50px;" /></a></li>

                        </div>
                        <div class="list-inline">
                            <li id="stPr"draggable="true"><a href="#" onclick="addStartOfProcess()"> <img src="~/Content/MenuItems/start_of_proces.png" alt="Image" style="width:50px;" /></a></li>
                            <li id="ter"draggable="true"><a href="#" onclick="addTerminator()"> <img src="~/Content/MenuItems/terminator.png" alt="Image" style=" height: 50px;" /></a></li>

                        </div>
                    </ul>
                </li>

            </ul>


        </div>
    </nav>

    <div class="can" id="can">
        <canvas id="c" width="1900" height="1000" />
    </div>


    <nav id="sidebarR">
        <div class="rightMenuScroll">

            <ul id="rightMenuScrollInsert" class="list-unstyled components"></ul>
        </div>
    </nav>

</div>

